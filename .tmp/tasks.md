# タスク分解 - Medi_Q スケジュール管理システム（自作版）

## ドキュメント情報
- **作成日**: 2025-11-14
- **更新日**: 2025-12-15
- **バージョン**: 2.0
- **ステータス**: Draft
- **関連ドキュメント**: requirements.md (v2.0), design.md (v2.0), test_design.md (v2.0)

---

## 1. プロジェクト全体タスク

### Phase 1: 企画・要件定義（完了）

| タスクID | タスク名 | 優先度 | ステータス | 備考 |
|---------|---------|--------|----------|------|
| T1-001 | planning.txt内容確認 | 高 | ✅ 完了 | - |
| T1-002 | .claude設定のMedi_Q対応 | 高 | ✅ 完了 | - |
| T1-003 | 要件定義書作成（v1.0） | 高 | ✅ 完了 | Google Calendar版 |
| T1-004 | 設計書作成（v1.0） | 高 | ✅ 完了 | Google Calendar版 |
| T1-005 | テスト設計書作成（v1.0） | 高 | ✅ 完了 | Google Calendar版 |
| T1-006 | タスク分解作成（v1.0） | 中 | ✅ 完了 | Google Calendar版 |
| T1-007 | 要件定義書改訂（v2.0） | 高 | ✅ 完了 | 自作システム版 |
| T1-008 | 設計書改訂（v2.0） | 高 | ✅ 完了 | 自作システム版 |
| T1-009 | テスト設計書改訂（v2.0） | 高 | ✅ 完了 | 自作システム版 |
| T1-010 | タスク分解改訂（v2.0） | 中 | ✅ 完了 | 自作システム版 |

---

## 2. Phase 2: 基盤構築

### 2.1 Prisma + SQLite セットアップ

| タスクID | タスク名 | 優先度 | ステータス | 依存 |
|---------|---------|--------|----------|------|
| T2-001 | Prisma インストール | 高 | ✅ 完了 | - |
| T2-002 | schema.prisma 作成 | 高 | ✅ 完了 | T2-001 |
| T2-003 | 初回マイグレーション実行 | 高 | ✅ 完了 | T2-002 |
| T2-004 | シードデータ作成（マスタ初期データ） | 中 | ✅ 完了 | T2-003 |
| T2-005 | Prismaクライアント設定（lib/prisma.ts） | 高 | ✅ 完了 | T2-003 |
| T2-006 | 環境変数設定（.env.local） | 高 | ✅ 完了 | T2-001 |

### 2.2 認証機能

| タスクID | タスク名 | 優先度 | ステータス | 依存 |
|---------|---------|--------|----------|------|
| T2-007 | bcrypt/jose インストール | 高 | ✅ 完了 | - |
| T2-008 | 認証ユーティリティ作成（lib/auth.ts） | 高 | ✅ 完了 | T2-007 |
| T2-009 | API: POST /api/auth/login | 高 | ✅ 完了 | T2-008 |
| T2-010 | API: POST /api/auth/logout | 中 | ✅ 完了 | T2-008 |
| T2-011 | API: GET /api/auth/session | 中 | ✅ 完了 | T2-008 |
| T2-012 | API: PUT /api/auth/password | 中 | ✅ 完了 | T2-008 |
| T2-013 | 認証ミドルウェア作成 | 高 | ✅ 完了 | T2-008 |
| T2-014 | ログイン画面（/admin/login） | 高 | ✅ 完了 | T2-009 |

### 2.3 既存コード整理

| タスクID | タスク名 | 優先度 | ステータス | 依存 |
|---------|---------|--------|----------|------|
| T2-015 | Google Calendar関連コード削除 | 高 | ⚪ 未着手 | - |
| T2-016 | /test-qr ページ削除 | 低 | ⚪ 未着手 | - |
| T2-017 | googleapis パッケージ削除 | 低 | ⚪ 未着手 | T2-015 |
| T2-018 | 型定義更新（types/index.ts） | 高 | ⚪ 未着手 | T2-002 |
| T2-019 | ディレクトリ構造整理 | 中 | ⚪ 未着手 | - |

---

## 3. Phase 3: API実装

### 3.1 患者管理API

| タスクID | タスク名 | 優先度 | ステータス | 依存 |
|---------|---------|--------|----------|------|
| T3-001 | API: GET /api/patients（一覧） | 高 | ✅ 完了 | T2-005 |
| T3-002 | API: GET /api/patients/[id]（詳細） | 高 | ✅ 完了 | T2-005 |
| T3-003 | API: POST /api/patients（登録） | 高 | ✅ 完了 | T2-005 |
| T3-004 | API: PUT /api/patients/[id]（更新） | 高 | ✅ 完了 | T2-005 |
| T3-005 | API: DELETE /api/patients/[id]（削除） | 中 | ✅ 完了 | T2-005 |
| T3-006 | 患者APIの単体テスト | 中 | ⚪ 未着手 | T3-005 |

### 3.2 スケジュール管理API

| タスクID | タスク名 | 優先度 | ステータス | 依存 |
|---------|---------|--------|----------|------|
| T3-007 | API: GET /api/schedules（期間指定一覧） | 高 | ✅ 完了 | T2-005 |
| T3-008 | API: GET /api/schedules/[id]（詳細） | 高 | ✅ 完了 | T2-005 |
| T3-009 | API: POST /api/schedules（登録） | 高 | ✅ 完了 | T2-005 |
| T3-010 | API: PUT /api/schedules/[id]（更新） | 高 | ✅ 完了 | T2-005 |
| T3-011 | API: DELETE /api/schedules/[id]（削除） | 中 | ✅ 完了 | T2-005 |
| T3-012 | スケジュールAPIの単体テスト | 中 | ⚪ 未着手 | T3-011 |

### 3.3 マスタ管理API

| タスクID | タスク名 | 優先度 | ステータス | 依存 |
|---------|---------|--------|----------|------|
| T3-013 | API: /api/masters（一括取得） | 中 | ✅ 完了 | T2-005 |
| T3-014 | API: /api/masters/departments（CRUD） | 中 | ⚪ 未着手 | T2-005 |
| T3-015 | API: /api/masters/doctors（CRUD） | 中 | ⚪ 未着手 | T2-005 |
| T3-016 | API: /api/masters/waiting-areas（CRUD） | 中 | ⚪ 未着手 | T2-005 |
| T3-017 | API: /api/masters/examinations（CRUD） | 中 | ⚪ 未着手 | T2-005 |
| T3-018 | マスタ使用中チェック実装 | 中 | ⚪ 未着手 | T3-017 |

### 3.4 受付処理API

| タスクID | タスク名 | 優先度 | ステータス | 依存 |
|---------|---------|--------|----------|------|
| T3-018 | API: POST /api/reception/checkin | 高 | ⚪ 未着手 | T3-007 |
| T3-019 | 来院ステータス更新ロジック | 高 | ⚪ 未着手 | T3-018 |
| T3-020 | 音声テキスト生成ロジック更新 | 中 | ⚪ 未着手 | T3-018 |
| T3-021 | 受付APIの単体テスト | 高 | ⚪ 未着手 | T3-020 |

---

## 4. Phase 4: 管理画面実装

### 4.1 共通レイアウト

| タスクID | タスク名 | 優先度 | ステータス | 依存 |
|---------|---------|--------|----------|------|
| T4-001 | 管理画面レイアウト（admin/layout.tsx） | 高 | ⚪ 未着手 | T2-014 |
| T4-002 | サイドバーコンポーネント | 高 | ⚪ 未着手 | T4-001 |
| T4-003 | ヘッダーコンポーネント | 中 | ⚪ 未着手 | T4-001 |
| T4-004 | 共通UIコンポーネント（Button, Input等） | 高 | ⚪ 未着手 | - |

### 4.2 ダッシュボード

| タスクID | タスク名 | 優先度 | ステータス | 依存 |
|---------|---------|--------|----------|------|
| T4-005 | ダッシュボード画面（/admin） | 中 | ⚪ 未着手 | T4-001 |
| T4-006 | 本日の予約一覧表示 | 中 | ⚪ 未着手 | T3-007 |
| T4-007 | 来院状況サマリー表示 | 低 | ⚪ 未着手 | T3-007 |

### 4.3 患者管理画面

| タスクID | タスク名 | 優先度 | ステータス | 依存 |
|---------|---------|--------|----------|------|
| T4-008 | 患者一覧画面（/admin/patients） | 高 | ✅ 完了 | T3-001 |
| T4-009 | 患者検索・フィルタ機能 | 中 | ✅ 完了 | T4-008 |
| T4-010 | ページネーション | 中 | ⚪ 未着手 | T4-008 |
| T4-011 | 患者登録画面（/admin/patients/new） | 高 | ✅ 完了 | T3-003 |
| T4-012 | 患者詳細画面（/admin/patients/[id]） | 高 | ✅ 完了 | T3-002 |
| T4-013 | QRコード表示コンポーネント | 高 | ✅ 完了 | T4-012 |
| T4-014 | QRコードダウンロード・印刷機能 | 中 | ✅ 完了 | T4-013 |
| T4-015 | 患者編集機能 | 高 | ✅ 完了 | T3-004 |
| T4-016 | 患者削除機能（確認ダイアログ付き） | 中 | ✅ 完了 | T3-005 |

### 4.4 スケジュール管理画面（カレンダー）

| タスクID | タスク名 | 優先度 | ステータス | 依存 |
|---------|---------|--------|----------|------|
| T4-017 | カレンダーライブラリ選定・導入 | 高 | ✅ 完了 | - |
| T4-018 | カレンダー月表示実装 | 高 | ✅ 完了 | T4-017 |
| T4-019 | カレンダー週表示実装 | 中 | ✅ 完了 | T4-017 |
| T4-020 | 予約のカレンダー表示 | 高 | ✅ 完了 | T3-007, T4-018 |
| T4-021 | 予約登録画面（/admin/schedules/new） | 高 | ✅ 完了 | T3-009 |
| T4-022 | 患者選択コンポーネント（検索付き） | 高 | ✅ 完了 | T4-021 |
| T4-023 | 診察科→担当医連動セレクト | 中 | ✅ 完了 | T4-021 |
| T4-024 | 検査項目複数選択 | 中 | ✅ 完了 | T4-021 |
| T4-025 | 予約詳細画面（/admin/schedules/[id]） | 高 | ⚪ 未着手 | T3-008 |
| T4-026 | 予約編集機能 | 高 | ⚪ 未着手 | T3-010 |
| T4-027 | 予約キャンセル機能 | 中 | ⚪ 未着手 | T3-011 |

### 4.5 マスタ管理画面

| タスクID | タスク名 | 優先度 | ステータス | 依存 |
|---------|---------|--------|----------|------|
| T4-028 | マスタ管理画面（/admin/masters） | 中 | ⚪ 未着手 | T4-001 |
| T4-029 | 診察科タブ実装 | 中 | ⚪ 未着手 | T3-013 |
| T4-030 | 担当医タブ実装 | 中 | ⚪ 未着手 | T3-014 |
| T4-031 | 待機場所タブ実装 | 中 | ⚪ 未着手 | T3-015 |
| T4-032 | 検査項目タブ実装 | 中 | ⚪ 未着手 | T3-016 |
| T4-033 | マスタ追加・編集モーダル | 中 | ⚪ 未着手 | T4-028 |
| T4-034 | マスタ削除（使用中チェック付き） | 中 | ⚪ 未着手 | T3-017 |

### 4.6 設定画面

| タスクID | タスク名 | 優先度 | ステータス | 依存 |
|---------|---------|--------|----------|------|
| T4-035 | 設定画面（/admin/settings） | 低 | ⚪ 未着手 | T4-001 |
| T4-036 | パスワード変更フォーム | 中 | ⚪ 未着手 | T2-012 |

---

## 5. Phase 5: 受付画面改修

| タスクID | タスク名 | 優先度 | ステータス | 依存 |
|---------|---------|--------|----------|------|
| T5-001 | 受付画面をSQLite対応に改修 | 高 | ⚪ 未着手 | T3-018 |
| T5-002 | checkin API呼び出しに変更 | 高 | ⚪ 未着手 | T3-018 |
| T5-003 | エラーハンドリング改善 | 中 | ⚪ 未着手 | T5-001 |
| T5-004 | 30秒自動クリア機能確認 | 中 | ⚪ 未着手 | T5-001 |
| T5-005 | システム状態表示更新（DB接続状態） | 低 | ⚪ 未着手 | T5-001 |

---

## 6. Phase 6: テスト・品質保証

### 6.1 単体テスト

| タスクID | タスク名 | 優先度 | ステータス | 依存 |
|---------|---------|--------|----------|------|
| T6-001 | Vitest セットアップ | 中 | ⚪ 未着手 | - |
| T6-002 | 認証ユーティリティのテスト | 中 | ⚪ 未着手 | T2-008 |
| T6-003 | API ルートのテスト | 中 | ⚪ 未着手 | Phase 3完了後 |

### 6.2 E2Eテスト

| タスクID | タスク名 | 優先度 | ステータス | 依存 |
|---------|---------|--------|----------|------|
| T6-004 | Playwright セットアップ | 中 | ⚪ 未着手 | - |
| T6-005 | ログインフローテスト | 高 | ⚪ 未着手 | T6-004 |
| T6-006 | 患者登録〜来院フローテスト | 高 | ⚪ 未着手 | T6-004 |
| T6-007 | 予約登録〜編集フローテスト | 中 | ⚪ 未着手 | T6-004 |

### 6.3 手動テスト

| タスクID | タスク名 | 優先度 | ステータス | 依存 |
|---------|---------|--------|----------|------|
| T6-008 | 機能テスト実施（TC-F101〜F105） | 高 | ⚪ 未着手 | Phase 5完了後 |
| T6-009 | 非機能テスト実施（TC-NFR101〜116） | 中 | ⚪ 未着手 | Phase 5完了後 |
| T6-010 | 統合テストシナリオ実施 | 高 | ⚪ 未着手 | T6-008 |

---

## 7. Phase 7: デプロイ・運用準備

| タスクID | タスク名 | 優先度 | ステータス | 依存 |
|---------|---------|--------|----------|------|
| T7-001 | 本番ビルド確認 | 高 | ⚪ 未着手 | Phase 6完了後 |
| T7-002 | 起動スクリプト作成（Windows用） | 中 | ⚪ 未着手 | T7-001 |
| T7-003 | バックアップスクリプト作成 | 中 | ⚪ 未着手 | T7-001 |
| T7-004 | 管理者初期パスワード設定 | 高 | ⚪ 未着手 | T7-001 |
| T7-005 | 初期マスタデータ投入 | 高 | ⚪ 未着手 | T7-001 |
| T7-006 | 受入テスト実施 | 高 | ⚪ 未着手 | T7-005 |

---

## 8. タスクサマリー

### 8.1 フェーズ別タスク数

| フェーズ | タスク数 | ステータス |
|---------|---------|----------|
| Phase 1: 企画・要件定義 | 10 | ✅ 完了 |
| Phase 2: 基盤構築 | 19 | 🔵 進行中（14/19完了） |
| Phase 3: API実装 | 22 | 🔵 進行中（11/22完了） |
| Phase 4: 管理画面実装 | 36 | 🔵 進行中（16/36完了） |
| Phase 5: 受付画面改修 | 5 | ⚪ 未着手 |
| Phase 6: テスト・品質保証 | 10 | ⚪ 未着手 |
| Phase 7: デプロイ・運用準備 | 6 | ⚪ 未着手 |
| **合計** | **107** | - |

### 8.2 優先度別タスク数

| 優先度 | タスク数 |
|--------|---------|
| 高 | 52 |
| 中 | 45 |
| 低 | 10 |

### 8.3 クリティカルパス

以下のタスクは遅延するとプロジェクト全体に影響:

1. **T2-001 → T2-003**: Prisma セットアップ → 初回マイグレーション
2. **T2-005**: Prismaクライアント設定（全API実装の前提）
3. **T2-008 → T2-014**: 認証機能 → ログイン画面
4. **T3-018**: 受付処理API（受付画面改修の前提）
5. **T4-017 → T4-020**: カレンダーUI実装

---

## 9. 次のアクション

### 9.1 即座に実施すべきタスク

1. **T4-025**: 予約詳細画面（/admin/schedules/[id]）
2. **T4-026**: 予約編集機能
3. **T3-002, T3-004, T3-005**: 患者詳細・更新・削除API

### 9.2 並行して実施可能

- T4-008〜T4-016: 患者管理画面
- T2-015〜T2-019: 既存コード整理

### 9.3 決定が必要な事項

- 初期管理者パスワードの決定

---

## 変更履歴

| 日付 | バージョン | 変更内容 | 作成者 |
|------|-----------|---------|--------|
| 2025-11-14 | 1.0 | 初版作成（Google Calendar連携版） | Claude |
| 2025-11-30 | 2.0 | SQLite + Prisma版に全面改訂 | Claude |
| 2025-12-15 | 2.1 | スケジュールAPI完了を反映、次のアクション更新 | Claude |
| 2025-12-15 | 2.2 | カレンダーUI実装、予約登録画面、マスタ/患者API | Claude |
| 2025-12-15 | 2.3 | 患者管理画面（一覧/登録/詳細/編集/削除/QRコード） | Claude |
